<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiosonde Notifier Bot Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg-primary: #121212;
        --bg-secondary: #1e1e1e;
        --bg-tertiary: #252525;
        --text-primary: #e0e0e0;
        --text-secondary: #a0a0a0;
        --accent: #3a6df0;
        --accent-hover: #2855de;
        --success: #4caf50;
        --warning: #ff9800;
        --danger: #f44336;
        --border-color: #333;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .header {
        background-color: var(--bg-secondary);
        padding: 15px 20px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header h1 {
        font-size: 1.8rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .header h1 i {
        color: var(--accent);
      }

      .header-buttons {
        display: flex;
        gap: 12px;
      }

      .header-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--bg-tertiary);
        color: var(--text-secondary);
        text-decoration: none;
        transition: all 0.2s ease;
      }

      .header-btn:hover {
        background-color: var(--accent);
        color: white;
        transform: translateY(-2px);
      }

      .dashboard-container {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      .sidebar {
        width: 320px;
        background-color: var(--bg-secondary);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      .tab-buttons {
        display: flex;
        border-bottom: 1px solid var(--border-color);
      }

      .tab-btn {
        flex: 1;
        padding: 12px;
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
      }

      .tab-btn:hover {
        background-color: var(--bg-tertiary);
      }

      .tab-btn.active {
        color: var(--accent);
        border-bottom: 2px solid var(--accent);
        background-color: var(--bg-tertiary);
      }

      .tab-content {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
      }

      .tab-pane {
        display: none;
      }

      .tab-pane.active {
        display: block;
      }

      .file-list {
        list-style: none;
      }

      .file-item {
        padding: 10px 12px;
        background-color: var(--bg-tertiary);
        border-radius: 4px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .file-item:hover {
        background-color: #2d2d2d;
      }

      .file-item.active {
        background-color: #2d2d2d;
        border-left: 3px solid var(--accent);
      }

      .file-content {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background-color: var(--bg-secondary);
      }

      .file-content pre {
        background-color: var(--bg-tertiary);
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        color: var(--text-primary);
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        max-height: 300px;
      }

      .subscriber-list {
        list-style: none;
      }

      .subscriber-item {
        padding: 12px;
        background-color: var(--bg-tertiary);
        border-radius: 4px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .subscriber-info {
        flex: 1;
      }

      .subscriber-name {
        font-weight: 500;
        margin-bottom: 4px;
      }

      .subscriber-details {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      .subscriber-actions {
        display: flex;
        gap: 8px;
      }

      .btn {
        padding: 6px 12px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.2s;
      }

      .btn-danger {
        background-color: var(--danger);
        color: white;
      }

      .btn-danger:hover {
        background-color: #d32f2f;
      }

      .stats-panel {
        padding: 15px;
        background-color: var(--bg-tertiary);
        border-radius: 4px;
        margin-bottom: 15px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .stat-item {
        text-align: center;
      }

      .stat-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-bottom: 4px;
      }

      .stat-value {
        font-size: 1.2rem;
        font-weight: 600;
      }

      .map-panel {
        height: 40%;
        background-color: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
      }

      .panel-header {
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: var(--bg-tertiary);
        border-bottom: 1px solid var(--border-color);
      }

      .panel-header h2 {
        font-size: 1.1rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .panel-content {
        flex: 1;
        position: relative;
      }

      #map {
        height: 100%;
        width: 100%;
      }

      .charts-container {
        height: 60%;
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 1px;
        background-color: var(--border-color);
        overflow: hidden;
      }

      .chart-panel {
        background-color: var(--bg-secondary);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .chart-panel .panel-header {
        padding: 10px 15px;
      }

      .chart-panel .panel-content {
        padding: 10px;
      }

      /* Map controls */
      .map-controls {
        display: flex;
        gap: 8px;
      }

      .map-style-btn {
        background-color: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.75rem;
      }

      .map-style-btn:hover {
        background-color: #2d2d2d;
      }

      .map-style-btn.active {
        background-color: var(--accent);
        color: white;
        border-color: var(--accent);
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-secondary);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--bg-tertiary);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* Responsive adjustments */
      @media (max-width: 1200px) {
        .sidebar {
          width: 280px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 992px) {
        .dashboard-container {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          max-height: 40vh;
          border-right: none;
          border-bottom: 1px solid var(--border-color);
        }

        .file-content {
          height: 60vh;
        }

        .header {
          flex-direction: column;
          gap: 15px;
          padding: 15px;
        }

        .header-buttons {
          align-self: flex-end;
        }
      }

      @media (max-width: 768px) {
        .charts-container {
          grid-template-columns: 1fr;
          grid-template-rows: repeat(4, 1fr);
        }

        .header h1 {
          font-size: 1.5rem;
        }

        .header-buttons {
          gap: 8px;
        }

        .header-btn {
          width: 36px;
          height: 36px;
        }

        .map-controls {
          flex-direction: column;
        }
      }

      @media (max-width: 480px) {
        .header {
          flex-direction: column;
          gap: 10px;
          text-align: center;
        }

        .header-buttons {
          align-self: center;
        }

        .header h1 {
          font-size: 1.3rem;
        }

        .tab-buttons {
          flex-direction: column;
        }
      }

      .json-key {
        color: #9cdcfe;
      }

      .json-string {
        color: #ce9178;
      }

      .json-number {
        color: #b5cea8;
      }

      .json-boolean {
        color: #569cd6;
      }

      .json-null {
        color: #569cd6;
      }

      .no-data {
        padding: 20px;
        text-align: center;
        color: var(--text-secondary);
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>
        <i class="fas fa-satellite"></i>Radiosonde Notifier Bot Dashboard
      </h1>
      <div class="header-buttons">
        <button id="refreshBtn" class="header-btn" title="Refresh Data">
          <i class="fas fa-sync-alt"></i>
        </button>
        <div class="header-btn" title="Auto Refresh: ON" id="autoRefreshToggle">
          <i class="fas fa-circle"></i>
        </div>
      </div>
    </div>
    <div class="dashboard-container">
      <div class="sidebar">
        <div class="tab-buttons">
          <button class="tab-btn active" data-tab="files">Files</button>
          <button class="tab-btn" data-tab="subscribers">Subscribers</button>
          <button class="tab-btn" data-tab="stats">Statistics</button>
        </div>
        <div class="tab-content">
          <div class="tab-pane active" id="files-tab">
            <h3>Bot Files</h3>
            <ul class="file-list" id="fileList">
              <li class="file-item" data-file="config.json">
                <i class="fas fa-cog"></i> config.json
              </li>
              <li class="file-item" data-file="subscriptions.json">
                <i class="fas fa-users"></i> subscriptions.json
              </li>
              <li class="file-item" data-file="bot.log">
                <i class="fas fa-scroll"></i> bot/radiosonde_notifier.log
              </li>
            </ul>
            <h3 style="margin-top: 20px;">Sonde Logs</h3>
            <ul class="file-list" id="sondeFilesList">
              <!-- Sonde files will be loaded here -->
            </ul>
          </div>
          <div class="tab-pane" id="subscribers-tab">
            <h3>Subscribed Users</h3>
            <div id="subscribersContainer">
              <!-- Subscribers will be loaded here -->
            </div>
          </div>
          <div class="tab-pane" id="stats-tab">
            <h3>Bot Statistics</h3>
            <div class="stats-panel">
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-label">Total Subscribers</div>
                  <div class="stat-value" id="totalSubscribers">0</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Active Sondes</div>
                  <div class="stat-value" id="activeSondes">0</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Total Log Files</div>
                  <div class="stat-value" id="totalLogFiles">0</div>
                </div>
                <div class="stat-item">
                  <div class="stat-label">Last Updated</div>
                  <div class="stat-value" id="lastUpdated">Never</div>
                </div>
              </div>
            </div>
            <h3>Monitoring Area</h3>
            <div id="monitoringConfig">
              <!-- Monitoring config will be loaded here -->
            </div>
          </div>
        </div>
      </div>
      <div class="file-content">
        <div id="fileViewer">
          <div class="panel-header">
            <h2>
              <i class="fas fa-file"></i> File Content
            </h2>
          </div>
          <div class="panel-content">
            <pre id="fileContent">Select a file to view its content</pre>
          </div>
        </div>
        <div class="map-panel">
          <div class="panel-header">
            <h2>
              <i class="fas fa-map-marked-alt"></i> Sonde Locations
            </h2>
            <div class="map-controls">
              <button class="map-style-btn active" data-style="dark">Dark</button>
              <button class="map-style-btn" data-style="light">Light</button>
              <button class="map-style-btn" data-style="terrain">Terrain</button>
              <button class="map-style-btn" data-style="satellite">Satellite</button>
            </div>
          </div>
          <div class="panel-content">
            <div id="map"></div>
          </div>
        </div>
        <div class="charts-container">
          <div class="chart-panel">
            <div class="panel-header">
              <h2>
                <i class="fas fa-chart-line"></i> Altitude Analysis
              </h2>
            </div>
            <div class="panel-content">
              <canvas id="altitudeChart"></canvas>
            </div>
          </div>
          <div class="chart-panel">
            <div class="panel-header">
              <h2>
                <i class="fas fa-chart-line"></i> Speed Analysis
              </h2>
            </div>
            <div class="panel-content">
              <canvas id="speedChart"></canvas>
            </div>
          </div>
          <div class="chart-panel">
            <div class="panel-header">
              <h2>
                <i class="fas fa-chart-line"></i> Vertical Velocity
              </h2>
            </div>
            <div class="panel-content">
              <canvas id="velocityChart"></canvas>
            </div>
          </div>
          <div class="chart-panel">
            <div class="panel-header">
              <h2>
                <i class="fas fa-chart-line"></i> Direction Analysis
              </h2>
            </div>
            <div class="panel-content">
              <canvas id="directionChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // Map configuration
      const mapStyles = {
        dark: {
          url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
          attribution: '&copy;  < a href = "https://www.openstreetmap.org/copyright" > OpenStreetMap < /a> contributors &copy;  < a href = "https://carto.com/attributions" > CARTO < /a>'
        },
        light: {
          url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
          attribution: '&copy;  < a href = "https://www.openstreetmap.org/copyright" > OpenStreetMap < /a> contributors'
        },
        terrain: {
          url: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
          attribution: 'Map data: &copy;  < a href = "https://www.openstreetmap.org/copyright" > OpenStreetMap < /a> contributors,  < a href = "http://viewfinderpanoramas.org" > SRTM < /a> | Map style: &copy;  < a href = "https://openttopomap.org" > OpenTopoMap < /a>'
        },
        satellite: {
          url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
          attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        }
      };
      // Global variables
      let map;
      let mapLayer;
      let altitudeChart, speedChart, velocityChart, directionChart;
      let autoRefreshInterval;
      let autoRefreshEnabled = true;
      let currentSondeData = {};
      let configData = {};
      let sondeFiles = [];
      // Initialize the application
      function init() {
        initMap();
        createCharts();
        setupEventListeners();
        loadAllData();
        startAutoRefresh();
      }
      // Initialize map with dark theme
      function initMap() {
        map = L.map('map').setView([44.4268, 26.1025], 10);
        setMapStyle('dark');
        // Add scale control
        L.control.scale({
          metric: true,
          imperial: false
        }).addTo(map);
      }
      // Set map style
      function setMapStyle(style) {
        if (mapLayer) {
          map.removeLayer(mapLayer);
        }
        mapLayer = L.tileLayer(mapStyles[style].url, {
          attribution: mapStyles[style].attribution,
          maxZoom: 18
        }).addTo(map);
        // Update active button state
        document.querySelectorAll('.map-style-btn').forEach(btn => {
          if (btn.dataset.style === style) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
      }
      // Create all charts
      function createCharts() {
        // Altitude chart
        const altCtx = document.getElementById('altitudeChart').getContext('2d');
        altitudeChart = new Chart(altCtx, {
          type: 'line',
          data: {
            datasets: []
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Altitude vs Time',
                color: '#e0e0e0'
              },
              legend: {
                display: false
              },
              tooltip: {
                mode: 'index',
                intersect: false
              }
            },
            scales: {
              x: {
                type: 'linear',
                title: {
                  display: true,
                  text: 'Time (minutes from launch)',
                  color: '#a0a0a0'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                  color: '#a0a0a0'
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Altitude (m)',
                  color: '#a0a0a0'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                  color: '#a0a0a0'
                }
              }
            }
          }
        });
        // Speed chart
        const speedCtx = document.getElementById('speedChart').getContext('2d');
        speedChart = new Chart(speedCtx, {
          type: 'line',
          data: {
            datasets: []
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Horizontal Speed vs Time',
                color: '#e0e0e0'
              },
              legend: {
                display: false
              },
              tooltip: {
                mode: 'index',
                intersect: false
              }
            },
            scales: {
              x: {
                type: 'linear',
                title: {
                  display: true,
                  text: 'Time (minutes from launch)',
                  color: '#a0a0a0'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                  color: '#a0a0a0'
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Horizontal Speed (km/h)',
                  color: '#a0a0a0'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                  color: '#a0a0a0'
                }
              }
            }
          }
        });
        // Vertical velocity chart
        const velocityCtx = document.getElementById('velocityChart').getContext('2d');
        velocityChart = new Chart(velocityCtx, {
          type: 'line',
          data: {
            datasets: []
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Vertical Velocity vs Time',
                color: '#e0e0e0'
              },
              legend: {
                display: false
              },
              tooltip: {
                mode: 'index',
                intersect: false
              }
            },
            scales: {
              x: {
                type: 'linear',
                title: {
                  display: true,
                  text: 'Time (minutes from launch)',
                  color: '#a0a0a0'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                  color: '#a0a0a0'
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Vertical Velocity (m/s)',
                  color: '#a0a0a0'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                  color: '#a0a0a0'
                }
              }
            }
          }
        });
        // Direction chart
        const directionCtx = document.getElementById('directionChart').getContext('2d');
        directionChart = new Chart(directionCtx, {
          type: 'scatter',
          data: {
            datasets: []
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Direction Analysis',
                color: '#e0e0e0'
              },
              legend: {
                display: false
              },
              tooltip: {
                mode: 'index',
                intersect: false
              }
            },
            scales: {
              x: {
                type: 'linear',
                title: {
                  display: true,
                  text: 'Time (minutes from launch)',
                  color: '#a0a0a0'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                  color: '#a0a0a0'
                }
              },
              y: {
                type: 'linear',
                min: 0,
                max: 360,
                title: {
                  display: true,
                  text: 'Direction (Â°)',
                  color: '#a0a0a0'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                  color: '#a0a0a0'
                }
              }
            }
          }
        });
      }
      // Setup event listeners
      function setupEventListeners() {
        // Tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const tab = btn.dataset.tab;
            // Update active tab button
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            // Show correct tab content
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');
          });
        });
        // File list items
        document.getElementById('fileList').addEventListener('click', (e) => {
          const fileItem = e.target.closest('.file-item');
          if (fileItem) {
            // Update active file
            document.querySelectorAll('.file-item').forEach(item => item.classList.remove('active'));
            fileItem.classList.add('active');
            // Load file content
            const fileName = fileItem.dataset.file;
            loadFileContent(fileName);
          }
        });
        // Sonde files list
        document.getElementById('sondeFilesList').addEventListener('click', (e) => {
          const fileItem = e.target.closest('.file-item');
          if (fileItem) {
            // Update active file
            document.querySelectorAll('.file-item').forEach(item => item.classList.remove('active'));
            fileItem.classList.add('active');
            // Load sonde file content
            const fileName = fileItem.dataset.file;
            loadSondeFileContent(fileName);
          }
        });
        // Refresh button
        document.getElementById('refreshBtn').addEventListener('click', () => {
          loadAllData();
        });
        // Auto refresh toggle
        document.getElementById('autoRefreshToggle').addEventListener('click', () => {
          autoRefreshEnabled = !autoRefreshEnabled;
          const icon = document.querySelector('#autoRefreshToggle i');
          if (autoRefreshEnabled) {
            icon.className = 'fas fa-circle';
            document.getElementById('autoRefreshToggle').title = 'Auto Refresh: ON';
            startAutoRefresh();
          } else {
            icon.className = 'fas fa-circle-notch';
            document.getElementById('autoRefreshToggle').title = 'Auto Refresh: OFF';
            stopAutoRefresh();
          }
        });
        // Map style buttons
        document.querySelectorAll('.map-style-btn').forEach(btn => {
          btn.addEventListener('click', () => setMapStyle(btn.dataset.style));
        });
      }
      // Start auto refresh
      function startAutoRefresh() {
        stopAutoRefresh();
        if (autoRefreshEnabled) {
          autoRefreshInterval = setInterval(loadAllData, 10000); // Refresh every 10 seconds
        }
      }
      // Stop auto refresh
      function stopAutoRefresh() {
        if (autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
        }
      }
      // Load all data
      async function loadAllData() {
        try {
          // Update last updated time
          document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
          // Load config
          await loadConfig();
          // Load subscribers
          await loadSubscribers();
          // Load bot log
          await loadBotLog();
          // Load sonde files list
          await loadSondeFilesList();
          // Update statistics
          updateStatistics();
        } catch (error) {
          console.error('Error loading data:', error);
        }
      }
      // Load config file
      async function loadConfig() {
        try {
          const response = await fetch('config.json');
          if (response.ok) {
            configData = await response.json();
            displayFileContent('config.json', JSON.stringify(configData, null, 2));
            // Update monitoring config in stats tab
            const monitoringConfig = configData.monitoring || {};
            document.getElementById('monitoringConfig').innerHTML = `

					<div class="stats-panel">
						<div class="stats-grid">
							<div class="stat-item">
								<div class="stat-label">Target Latitude</div>
								<div class="stat-value">${monitoringConfig.target_latitude || 'N/A'}</div>
							</div>
							<div class="stat-item">
								<div class="stat-label">Target Longitude</div>
								<div class="stat-value">${monitoringConfig.target_longitude || 'N/A'}</div>
							</div>
							<div class="stat-item">
								<div class="stat-label">Radius</div>
								<div class="stat-value">${monitoringConfig.radius_km || 'N/A'} km</div>
							</div>
							<div class="stat-item">
								<div class="stat-label">Min Altitude</div>
								<div class="stat-value">${monitoringConfig.min_altitude_m || 'N/A'} m</div>
							</div>
							<div class="stat-item">
								<div class="stat-label">Max Altitude</div>
								<div class="stat-value">${monitoringConfig.max_altitude_m || 'N/A'} m</div>
							</div>
						</div>
					</div>
                    `;
          } else {
            displayFileContent('config.json', 'Error: Config file not found or inaccessible');
          }
        } catch (error) {
          displayFileContent('config.json', `Error loading config: ${error.message}`);
        }
      }
      // Load subscribers
      async function loadSubscribers() {
        try {
          const response = await fetch('subscriptions.json');
          if (response.ok) {
            const subscribers = await response.json();
            displayFileContent('subscriptions.json', JSON.stringify(subscribers, null, 2));
            // Update subscribers list
            const subscribersContainer = document.getElementById('subscribersContainer');
            subscribersContainer.innerHTML = '';
            if (Object.keys(subscribers).length === 0) {
              subscribersContainer.innerHTML = ' < div class = "no-data" > No subscribers found < /div>';
            } else {
              for (const [id, user] of Object.entries(subscribers)) {
                const subscriberElement = document.createElement('div');
                subscriberElement.className = 'subscriber-item';
                subscriberElement.innerHTML = `

					<div class="subscriber-info">
						<div class="subscriber-name">${user.name || 'Unknown'}</div>
						<div class="subscriber-details">
                                        ID: ${id} | Subscribed: ${new Date(user.subscribed_at).toLocaleDateString()}
                                    </div>
					</div>
					<div class="subscriber-actions">
						<button class="btn btn-danger" data-id="${id}">Remove</button>
					</div>
                            `;
                subscribersContainer.appendChild(subscriberElement);
              }
            }
            // Update total subscribers count
            document.getElementById('totalSubscribers').textContent = Object.keys(subscribers).length;
          } else {
            displayFileContent('subscriptions.json', 'Error: Subscriptions file not found or inaccessible');
            document.getElementById('subscribersContainer').innerHTML = ' < div class = "no-data" > Error loading subscribers < /div>';
          }
        } catch (error) {
          displayFileContent('subscriptions.json', `Error loading subscribers: ${error.message}`);
          document.getElementById('subscribersContainer').innerHTML = ' < div class = "no-data" > Error loading subscribers < /div>';
        }
      }
      // Load bot log
      async function loadBotLog() {
        try {
          const response = await fetch('history/bot/radiosonde_notifier.log');
          if (response.ok) {
            const logContent = await response.text();
            displayFileContent('bot.log', logContent);
          } else {
            displayFileContent('bot.log', 'Error: Log file not found or inaccessible');
          }
        } catch (error) {
          displayFileContent('bot.log', `Error loading log: ${error.message}`);
        }
      }
      // Load sonde files list
      async function loadSondeFilesList() {
        try {
          // In a real implementation, you would fetch this from a server endpoint
          // that lists the files in the history/sondes directory
          // For this example, we'll simulate it with a fixed list
          const response = await fetch('history/sondes/');
          if (response.ok) {
            // This would be replaced with actual API call to get the list of sonde files
            const simulatedSondeFiles = ['S12345678.log', 'S87654321.log', 'S11223344.log'];
            sondeFiles = simulatedSondeFiles;
            const sondeFilesList = document.getElementById('sondeFilesList');
            sondeFilesList.innerHTML = '';
            if (simulatedSondeFiles.length === 0) {
              sondeFilesList.innerHTML = ' < div class = "no-data" > No sonde logs available yet < /div>';
            } else {
              simulatedSondeFiles.forEach(fileName => {
                const fileItem = document.createElement('li');
                fileItem.className = 'file-item';
                fileItem.dataset.file = fileName;
                fileItem.innerHTML = `
					<i class="fas fa-satellite"></i> ${fileName}`;
                sondeFilesList.appendChild(fileItem);
              });
            }
            // Update total log files count
            document.getElementById('totalLogFiles').textContent = simulatedSondeFiles.length;
          } else {
            document.getElementById('sondeFilesList').innerHTML = ' < div class = "no-data" > No sonde logs available yet < /div>';
          }
        } catch (error) {
          console.error('Error loading sonde files list:', error);
          document.getElementById('sondeFilesList').innerHTML = ' < div class = "no-data" > Error loading sonde logs < /div>';
        }
      }
      // Load sonde file content
      async function loadSondeFileContent(fileName) {
        try {
          // In a real implementation, you would fetch the file content from the server
          // For this example, we'll simulate it with sample data
          const response = await fetch(`history/sondes/${fileName}`);
          if (response.ok) {
            const fileContent = await response.text();
            displayFileContent(fileName, fileContent);
            // Parse and visualize the sonde data
            const sondeData = JSON.parse(fileContent);
            currentSondeData = sondeData;
            visualizeSondeData(sondeData);
          } else {
            displayFileContent(fileName, 'Error: Sonde log file not found or inaccessible');
          }
        } catch (error) {
          displayFileContent(fileName, `Error loading sonde log: ${error.message}`);
        }
      }
      // Display file content with syntax highlighting
      function displayFileContent(fileName, content) {
        const fileContentElement = document.getElementById('fileContent');
        if (fileName.endsWith('.json')) {
          try {
            const jsonObj = JSON.parse(content);
            fileContentElement.innerHTML = syntaxHighlightJson(JSON.stringify(jsonObj, null, 2));
          } catch {
            fileContentElement.textContent = content;
          }
        } else {
          fileContentElement.textContent = content;
        }
      }
      // Syntax highlight JSON
      function syntaxHighlightJson(json) {
        json = json.replace(/&/g, '&amp;').replace(/ < /g, '&lt;').replace(/ > /g, '&gt;');
          return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function(match) {
            let cls = 'json-number';
            if (/^"/.test(match)) {
              if (/:$/.test(match)) {
                cls = 'json-key';
              } else {
                cls = 'json-string';
              }
            } else if (/true|false/.test(match)) {
              cls = 'json-boolean';
            } else if (/null/.test(match)) {
              cls = 'json-null';
            }
            return ' < span class = "' + cls + '" > ' + match + ' < /span>';
          });
        }
        // Visualize sonde data on map and charts
        function visualizeSondeData(sondeData) {
          // Clear previous markers
          map.eachLayer(layer => {
            if (layer instanceof L.Marker) {
              map.removeLayer(layer);
            }
          });
          // Add new markers for each position
          if (sondeData.positions && sondeData.positions.length > 0) {
            sondeData.positions.forEach((position, index) => {
              const marker = L.marker([position.lat, position.lon]).addTo(map);
              // Make the last position more prominent
              if (index === sondeData.positions.length - 1) {
                marker.setIcon(L.icon({
                  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                  iconSize: [25, 41],
                  iconAnchor: [12, 41],
                  popupAnchor: [1, -34],
                  shadowSize: [41, 41]
                }));
              }
              marker.bindPopup(`

				<strong>Sonde: ${sondeData.serial}</strong>
				<br>
                        Time: ${new Date(position.datetime).toLocaleString()}
					<br>
                        Altitude: ${position.alt} m
						<br>
                        Speed: ${position.speed} km/h
                    `);
            });
            // Fit map to show all markers
            const bounds = sondeData.positions.map(pos => [pos.lat, pos.lon]);
            map.fitBounds(bounds);
          }
          // Update charts with sonde data
          updateCharts(sondeData);
        }
        // Update charts with sonde data
        function updateCharts(sondeData) {
          if (!sondeData.positions || sondeData.positions.length === 0) return;
          // Prepare data for charts
          const startTime = new Date(sondeData.positions[0].datetime).getTime();
          const chartData = sondeData.positions.map(pos => {
            const timeDiff = (new Date(pos.datetime).getTime() - startTime) / (1000 * 60); // minutes
            return {
              time: timeDiff,
              alt: pos.alt,
              speed: pos.speed,
              vs: pos.vs,
              direction: pos.direction
            };
          });
          // Update altitude chart
          altitudeChart.data = {
            datasets: [{
              label: 'Altitude',
              data: chartData.map(d => ({
                x: d.time,
                y: d.alt
              })),
              borderColor: '#3a6df0',
              backgroundColor: 'rgba(58, 109, 240, 0.1)',
              tension: 0.4,
              fill: true
            }]
          };
          altitudeChart.update();
          // Update speed chart
          speedChart.data = {
            datasets: [{
              label: 'Speed',
              data: chartData.map(d => ({
                x: d.time,
                y: d.speed
              })),
              borderColor: '#4caf50',
              backgroundColor: 'rgba(76, 175, 80, 0.1)',
              tension: 0.4,
              fill: true
            }]
          };
          speedChart.update();
          // Update velocity chart
          velocityChart.data = {
            datasets: [{
              label: 'Vertical Velocity',
              data: chartData.map(d => ({
                x: d.time,
                y: d.vs
              })),
              borderColor: '#ff9800',
              backgroundColor: 'rgba(255, 152, 0, 0.1)',
              tension: 0.4,
              fill: true
            }]
          };
          velocityChart.update();
          // Update direction chart
          directionChart.data = {
            datasets: [{
              label: 'Direction',
              data: chartData.map(d => ({
                x: d.time,
                y: d.direction
              })),
              borderColor: '#9c27b0',
              backgroundColor: 'rgba(156, 39, 176, 0.1)',
              pointRadius: 4,
              showLine: false
            }]
          };
          directionChart.update();
        }

        // Update statistics
        function updateStatistics() {
          // Active sondes would normally be calculated from the data
          // For this example, we'll set it to the number of sonde files
          document.getElementById('activeSondes').textContent = sondeFiles.length;
        }
        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
  </body>
</html>